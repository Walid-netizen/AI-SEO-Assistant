<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SEO Assistant | Premium Dashboard</title>
    <!-- Base64 Favicon to prevent 404 -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Conic Gradient for Gauge */
        .gauge-circle {
            background: conic-gradient(var(--gauge-color) var(--gauge-value), #334155 0deg);
            transition: background 1s ease-out;
            border-radius: 50%;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151f32', 900: '#0f172a' },
                        violet: { 600: '#7c3aed', 700: '#6d28d9' },
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-900 text-slate-100 flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-80 bg-slate-850 border-r border-slate-700 flex flex-col shadow-2xl z-10 hidden md:flex">
        <div class="p-6 border-b border-slate-700 flex items-center gap-3">
            <div
                class="w-10 h-10 bg-violet-600 rounded-xl flex items-center justify-center shadow-lg shadow-violet-500/30">
                <i data-lucide="sparkles" class="text-white"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg tracking-tight">AI SEO Assistant</h1>
                <p class="text-xs text-slate-400">Professional Audit Tool</p>
            </div>
        </div>

        <div class="p-6 flex-1 overflow-y-auto space-y-6">
            <!-- Provider Selection -->
            <div>
                <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">AI
                    Provider</label>
                <div class="grid grid-cols-3 gap-2 p-1 bg-slate-800 rounded-lg">
                    <button onclick="setProvider('mock')" id="btn-mock"
                        class="provider-btn py-2 text-sm rounded-md transition-all font-medium text-slate-400 hover:text-white">Mock</button>
                    <button onclick="setProvider('openai')" id="btn-openai"
                        class="provider-btn py-2 text-sm rounded-md transition-all font-medium text-slate-400 hover:text-white">OpenAI</button>
                    <button onclick="setProvider('gemini')" id="btn-gemini"
                        class="provider-btn py-2 text-sm rounded-md transition-all font-medium text-slate-400 hover:text-white">Gemini</button>
                </div>
            </div>

            <!-- Configuration Form -->
            <div id="config-panel" class="space-y-4 transition-all duration-300">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-1">API Key</label>
                    <div class="relative">
                        <input type="password" id="api-key" placeholder="sk-..."
                            class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 outline-none transition-colors">
                        <button onclick="toggleVisibility()"
                            class="absolute right-3 top-2.5 text-slate-500 hover:text-slate-300">
                            <i data-lucide="eye" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <p class="text-xs text-slate-500 mt-1">Saved securely in your browser.</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-1">Model</label>
                    <select id="model-select"
                        class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-violet-500 outline-none">
                        <!-- Populated by JS -->
                    </select>
                </div>
            </div>

            <div class="p-4 bg-slate-800/50 rounded-xl border border-dashed border-slate-700">
                <div class="flex items-center gap-2 text-violet-400 mb-2">
                    <i data-lucide="zap" class="w-4 h-4"></i>
                    <span class="text-xs font-bold uppercase">Pro Tip</span>
                </div>
                <p class="text-xs text-slate-400 leading-relaxed">
                    Use <strong>Mock Mode</strong> to test the UI flow without using API credits. Switch to
                    <strong>Gemini</strong> for fast, cost-effective audits.
                </p>
            </div>
        </div>

        <div class="p-4 border-t border-slate-700 text-center">
            <p class="text-xs text-slate-500">&copy; 2025 AI SEO Assistant</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden bg-slate-900 relative">

        <!-- Header (Mobile Toggle etc) -->
        <header
            class="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900/95 backdrop-blur z-20 md:hidden">
            <span class="font-bold">AI SEO Assistant</span>
            <button class="text-slate-400"><i data-lucide="menu"></i></button>
        </header>

        <!-- Scrollable Area -->
        <div class="flex-1 overflow-y-auto p-6 md:p-10 scroll-smooth">
            <div class="max-w-5xl mx-auto space-y-8">

                <!-- Input Section -->
                <section class="space-y-4">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-white">Content Analysis</h2>
                        <div class="flex gap-2">
                            <button onclick="loadSample()"
                                class="text-xs bg-slate-800 hover:bg-slate-700 px-3 py-1.5 rounded-full text-slate-300 transition">Load
                                Sample</button>
                            <button onclick="clearText()"
                                class="text-xs bg-slate-800 hover:bg-red-900/30 text-red-400 hover:text-red-300 px-3 py-1.5 rounded-full transition">Clear</button>
                        </div>
                    </div>
                    <div class="relative group">
                        <textarea id="content-input"
                            class="w-full h-64 bg-slate-800/50 border border-slate-700 rounded-2xl p-5 text-slate-300 focus:border-violet-500 focus:bg-slate-800 focus:ring-4 focus:ring-violet-500/10 outline-none transition-all resize-none shadow-inner text-base leading-relaxed"
                            placeholder="Paste your article content here to analyze..."></textarea>

                        <div class="absolute bottom-5 right-5">
                            <span id="word-count" class="text-xs text-slate-500 bg-slate-900/80 px-2 py-1 rounded-md">0
                                words</span>
                        </div>
                    </div>

                    <button onclick="analyzeContent()" id="analyze-btn"
                        class="w-full py-4 bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-500 hover:to-indigo-500 text-white rounded-xl font-semibold shadow-lg shadow-violet-500/25 transition-all transform hover:scale-[1.01] active:scale-[0.99] flex items-center justify-center gap-2 group">
                        <i data-lucide="scan-search" class="w-5 h-5 group-hover:rotate-12 transition-transform"></i>
                        <span>Analyze Content</span>
                    </button>
                </section>

                <!-- Results Section (Hidden by default) -->
                <div id="results-container" class="hidden space-y-8 pb-20">

                    <!-- Top Stats Row -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Score Gauge -->
                        <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700 flex flex-col items-center justify-center relative overflow-hidden fade-in"
                            style="animation-delay: 0.1s">
                            <h3 class="text-slate-400 text-sm font-medium uppercase tracking-wider mb-4">SEO Health
                                Score</h3>
                            <div class="relative w-40 h-40">
                                <div class="gauge-circle w-full h-full rounded-full flex items-center justify-center"
                                    id="score-ring" style="--gauge-value: 0deg; --gauge-color: #334155;">
                                    <div
                                        class="w-32 h-32 bg-slate-800 rounded-full flex flex-col items-center justify-center z-10">
                                        <span id="score-value" class="text-4xl font-bold text-white">0</span>
                                        <span class="text-xs text-slate-500">/ 100</span>
                                    </div>
                                </div>
                            </div>
                            <div id="score-label"
                                class="mt-4 px-3 py-1 rounded-full text-xs font-bold bg-slate-700 text-slate-300">
                                Calculating...</div>
                        </div>

                        <!-- Meta Preview -->
                        <div class="md:col-span-2 bg-slate-800 rounded-2xl p-6 border border-slate-700 fade-in"
                            style="animation-delay: 0.2s">
                            <h3
                                class="text-slate-400 text-sm font-medium uppercase tracking-wider mb-4 flex items-center gap-2">
                                <i data-lucide="search" class="w-4 h-4"></i> Google Search Preview
                            </h3>
                            <div class="bg-white rounded-lg p-5 shadow-sm font-sans max-w-2xl mx-auto">
                                <div class="flex items-center gap-2 mb-1">
                                    <div
                                        class="w-7 h-7 bg-gray-100 rounded-full flex items-center justify-center text-xs text-gray-500">
                                        W</div>
                                    <div class="flex flex-col">
                                        <span class="text-[12px] text-gray-800 font-medium">Your Website Name</span>
                                        <span class="text-[10px] text-gray-500">https://www.yoursite.com/article</span>
                                    </div>
                                </div>
                                <a href="#" class="text-[#1a0dab] text-xl hover:underline truncate block mb-1"
                                    id="meta-title">Loading Title...</a>
                                <p class="text-[#4d5156] text-sm leading-snug line-clamp-2" id="meta-desc">Loading
                                    description...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Strengths & Weaknesses -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-slate-800/50 rounded-2xl p-6 border border-green-900/30 fade-in"
                            style="animation-delay: 0.3s">
                            <h3 class="text-green-400 font-semibold mb-4 flex items-center gap-2">
                                <i data-lucide="thumbs-up" class="w-5 h-5"></i> Strengths
                            </h3>
                            <ul id="list-strengths" class="space-y-3"></ul>
                        </div>
                        <div class="bg-slate-800/50 rounded-2xl p-6 border border-red-900/30 fade-in"
                            style="animation-delay: 0.4s">
                            <h3 class="text-red-400 font-semibold mb-4 flex items-center gap-2">
                                <i data-lucide="alert-triangle" class="w-5 h-5"></i> Fix Priorities
                            </h3>
                            <ul id="list-weaknesses" class="space-y-3"></ul>
                        </div>
                    </div>

                    <!-- Keywords -->
                    <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700 fade-in"
                        style="animation-delay: 0.5s">
                        <h3
                            class="text-slate-400 text-sm font-medium uppercase tracking-wider mb-4 flex items-center gap-2">
                            <i data-lucide="hash" class="w-4 h-4"></i> Keyword Strategy
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <span class="text-xs text-slate-500 mb-2 block">Primary Keywords</span>
                                <div id="keywords-primary" class="flex flex-wrap gap-2"></div>
                            </div>
                            <div class="h-px bg-slate-700"></div>
                            <div>
                                <span class="text-xs text-slate-500 mb-2 block">Long-tail Variations</span>
                                <div id="keywords-longtail" class="flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Plan -->
                    <div class="bg-gradient-to-br from-violet-900/20 to-indigo-900/20 rounded-2xl p-6 border border-violet-500/20 fade-in"
                        style="animation-delay: 0.6s">
                        <h3 class="text-violet-300 font-semibold mb-3 flex items-center gap-2">
                            <i data-lucide="lightbulb" class="w-5 h-5"></i> Content Suggestions
                        </h3>
                        <p id="suggestions-text" class="text-slate-300 leading-relaxed whitespace-pre-line"></p>
                    </div>

                </div>

            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast"
        class="fixed bottom-6 right-6 bg-red-500 text-white px-6 py-3 rounded-lg shadow-xl translate-y-24 transition-transform duration-300 flex items-center gap-3 z-50">
        <i data-lucide="alert-circle" class="w-5 h-5"></i>
        <span id="toast-msg">Error message here</span>
    </div>

    <!-- Main Script Logic -->
    <script>
        // --- Safe Storage Handler ---
        const SafeStorage = {
            memory: {},
            setItem: function (key, value) {
                try {
                    localStorage.setItem(key, value);
                } catch (e) {
                    console.warn('LocalStorage blocked, using memory fallback.');
                    this.memory[key] = value;
                }
            },
            getItem: function (key) {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    return this.memory[key] || null;
                }
            }
        };

        // --- State Management ---
        let state = {
            provider: 'mock',
            apiKey: SafeStorage.getItem('aiseo_api_key') || '',
            model: ''
        };

        // --- Models Config ---
        const models = {
            mock: ['demo-mode'],
            openai: ['gpt-4o', 'gpt-4-turbo', 'gpt-3.5-turbo'],
            gemini: ['gemini-1.5-flash', 'gemini-pro', 'gemini-1.5-pro']
        };

        // --- Initialize ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            document.getElementById('api-key').value = state.apiKey;
            setProvider(state.apiKey ? 'openai' : 'mock');

            // Input Listener
            document.getElementById('content-input').addEventListener('input', function () {
                const count = this.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                document.getElementById('word-count').innerText = count + " words";
            });

            // API Key Listener
            document.getElementById('api-key').addEventListener('input', function () {
                state.apiKey = this.value;
                SafeStorage.setItem('aiseo_api_key', this.value);
                if (state.provider === 'mock' && this.value) setProvider('openai');
            });

            // Model Listener
            document.getElementById('model-select').addEventListener('change', function () {
                state.model = this.value;
            });
        });

        // --- Core Logic ---
        function setProvider(provider) {
            state.provider = provider;

            document.querySelectorAll('.provider-btn').forEach(btn => {
                btn.classList.remove('bg-violet-600', 'text-white', 'shadow-lg');
                btn.classList.add('text-slate-400');
            });
            const activeBtn = document.getElementById(`btn-${provider}`);
            if (activeBtn) {
                activeBtn.classList.add('bg-violet-600', 'text-white', 'shadow-lg');
                activeBtn.classList.remove('text-slate-400');
            }

            const panel = document.getElementById('config-panel');
            if (provider === 'mock') {
                panel.classList.add('opacity-50', 'pointer-events-none');
            } else {
                panel.classList.remove('opacity-50', 'pointer-events-none');
            }

            const select = document.getElementById('model-select');
            select.innerHTML = '';
            if (models[provider]) {
                models[provider].forEach(m => {
                    const op = document.createElement('option');
                    op.value = m;
                    op.text = m;
                    select.appendChild(op);
                });
                state.model = select.value;
            }
        }

        function toggleVisibility() {
            const input = document.getElementById('api-key');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function loadSample() {
            const sample = "Daily exercise plays a vital role in maintaining both physical and mental health. Engaging in regular physical activity helps improve cardiovascular health, strengthen muscles, and boost the immune system. \n\nIn addition to physical benefits, daily exercise greatly improves mental health. It helps reduce stress, anxiety, and depression by releasing endorphins. By dedicating just 30 minutes a day, one can ensure a balanced and energetic lifestyle.";
            document.getElementById('content-input').value = sample;
            document.getElementById('content-input').dispatchEvent(new Event('input'));
        }

        function clearText() {
            document.getElementById('content-input').value = '';
            document.getElementById('content-input').dispatchEvent(new Event('input'));
            document.getElementById('results-container').classList.add('hidden');
        }

        async function analyzeContent() {
            const content = document.getElementById('content-input').value;
            if (!content || content.split(' ').length < 10) {
                showToast('Please enter at least 10 words to analyze.');
                return;
            }

            if (state.provider !== 'mock' && !state.apiKey) {
                showToast(`API Key required for ${state.provider.toUpperCase()}.`);
                return;
            }

            setLoading(true);
            document.getElementById('results-container').classList.add('hidden');

            try {
                const apiUrl = './test_article.php';

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    referrerPolicy: "no-referrer-when-downgrade", // NEW: Policy update
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        provider: state.provider,
                        apiKey: state.apiKey,
                        model: state.model,
                        content: content
                    })
                });

                const rawText = await response.text();

                // Custom 405 Advice
                if (response.status === 405) {
                    throw new Error("Server Error (405): POST Blocked. Try moving project to C:/xampp/htdocs/ and access via localhost.");
                }

                if (!response.ok) {
                    console.error("HTTP Error:", response.status, rawText);
                    throw new Error(`Server Error (${response.status})`);
                }

                if (!rawText || rawText.trim() === '') {
                    throw new Error("Server returned an empty response.");
                }

                let data;
                try {
                    data = JSON.parse(rawText);
                } catch (e) {
                    console.error("JSON Parse Error. Raw Response:", rawText);
                    throw new Error("Invalid response from server. Check console.");
                }

                if (data.error) {
                    throw new Error(data.message || 'API Error');
                }

                renderResults(data);

            } catch (err) {
                showToast(err.message);
                console.error(err);
            } finally {
                setLoading(false);
            }
        }

        function renderResults(data) {
            document.getElementById('results-container').classList.remove('hidden');

            // Score
            const score = data.seo_score || 0;
            let color = '#ef4444'; // red
            if (score > 50) color = '#eab308'; // yellow
            if (score > 80) color = '#22c55e'; // green

            document.getElementById('score-value').innerText = score;
            document.getElementById('score-ring').style.setProperty('--gauge-color', color);
            document.getElementById('score-ring').style.setProperty('--gauge-value', `${score * 3.6}deg`); // 360deg max

            const label = document.getElementById('score-label');
            label.innerText = score > 80 ? 'Excellent' : (score > 50 ? 'Needs Improvement' : 'Critical Issues');
            label.className = `mt-4 px-3 py-1 rounded-full text-xs font-bold ${score > 80 ? 'bg-green-900/30 text-green-400' : (score > 50 ? 'bg-yellow-900/30 text-yellow-400' : 'bg-red-900/30 text-red-400')}`;

            // Meta
            document.getElementById('meta-title').innerText = data.meta.title || 'No Title Generated';
            document.getElementById('meta-desc').innerText = data.meta.description || 'No Description Generated';

            // Lists
            renderList('list-strengths', data.strengths, 'check-circle-2', 'text-green-400');
            renderList('list-weaknesses', data.weaknesses, 'x-circle', 'text-red-400');

            // Keywords
            renderKeywords('keywords-primary', data.keywords.primary, 'bg-violet-900/40 text-violet-300 border-violet-700/50');
            renderKeywords('keywords-longtail', data.keywords.long_tail, 'bg-slate-700/50 text-slate-300 border-slate-600/50');

            // Suggestions
            document.getElementById('suggestions-text').innerText = data.suggestions || 'No suggestions.';

            // Re-init Icons
            lucide.createIcons();

            // Scroll to results
            setTimeout(() => {
                document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function renderList(id, items, icon, colorClass) {
            const el = document.getElementById(id);
            el.innerHTML = '';
            if (!items || items.length === 0) {
                el.innerHTML = '<li class="text-sm text-slate-500 italic">None detected.</li>';
                return;
            }
            items.forEach(item => {
                el.innerHTML += `
                <li class="flex items-start gap-2.5 text-sm text-slate-300">
                    <i data-lucide="${icon}" class="w-4 h-4 mt-0.5 ${colorClass} shrink-0"></i>
                    <span>${item}</span>
                </li>`;
            });
        }

        function renderKeywords(id, items, classes) {
            const el = document.getElementById(id);
            el.innerHTML = '';
            if (!items || items.length === 0) {
                el.innerHTML = '<span class="text-sm text-slate-500 italic">None.</span>';
                return;
            }
            items.forEach(item => {
                el.innerHTML += `<span class="px-3 py-1 rounded-md text-xs font-medium border ${classes}">${item}</span>`;
            });
        }

        function setLoading(isLoading) {
            const btn = document.getElementById('analyze-btn');
            if (isLoading) {
                btn.disabled = true;
                btn.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i><span>Processing...</span>`;
                btn.classList.add('opacity-75', 'cursor-not-allowed');
            } else {
                btn.disabled = false;
                btn.innerHTML = `<i data-lucide="scan-search" class="w-5 h-5"></i><span>Analyze Content</span>`;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
                lucide.createIcons();
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-24');
            setTimeout(() => toast.classList.add('translate-y-24'), 4000);
        }
    </script>
</body>

</html>